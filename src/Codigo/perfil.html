<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/css/bootstrap.min.css"
      integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T"
      crossorigin="anonymous"
    />
    <script
      src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
      integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/popper.js@1.14.7/dist/umd/popper.min.js"
      integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/js/bootstrap.min.js"
      integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
      crossorigin="anonymous"
    ></script>
    <link rel="stylesheet" href="CSS/stylelogin.css" />
    <script src="JS/saudacao.js"></script>
    <script src="JS/login.js"></script>
    <title>MEX</title>
    <script>
      // Verifica se o usuário já esta logado e se negativo, redireciona para tela de login
      if (!usuarioCorrente.login) {
        window.location.href = LOGIN_URL;
      }

      function initPage() {
        // Associa a função de logout ao botão
        document
          .getElementById("btn_logout")
          .addEventListener("click", logoutUser);

        // Informa o nome do usuário logado
        document.getElementById("nomeUsuario").innerHTML = usuarioCorrente.nome;
        document.getElementById("Usuario").innerHTML = usuarioCorrente.login;
        document.getElementById("email").innerHTML = usuarioCorrente.email;

        // Lista os usuários
        exibeUsuarios();
      }

      // Associa ao evento de carga da página a função para verificar se o usuário está logado
      window.addEventListener("load", initPage);
    </script>
  </head>
  <body>
    <!--CABEÇALHO NAV BAR -->
    <header class="navbar sticky-top navbar-dark navBar static-top">
      <a href="indexlog.html">
        <img class="logo" src="IMG/logo.png" alt="Logo" />
      </a>
      <div class="buttons">
        <h2><a class="navbar-brand" href="inicio.html">Menu</a></h2>
        <h2>
          <a class="navbar-brand" id="btn_logout" href="index.html"
            >Sair</a
          >
        </h2>
      </div>
    </header>
    <div class="container">
      <br />
      <div class="conteudo">
        <!--Barra de boas vindas com hora-->
        <h3>Perfil:</h3>
        <br />
        <br />
        <hr />
        <div class="topo">
          <img class="topo" src="IMG/logoop2.png" />
        </div>
        <br /><br />
        <div class="row">
          <div class="h4 col-md-2">Nome:</div>
          <div class="h4 col-md-8"><span id="nomeUsuario"></span></div>
        </div>
        <br />
        <div class="row">
          <div class="h4 col-md-2">Usuário:</div>
          <div class="h4 col-md-8"><span id="Usuario"></span></div>
        </div>
        <br />
        <div class="row">
          <div class="h4 col-md-2">E-mail:</div>
          <div class="h4 col-md-8"><span id="email"></span></div>
        </div>
        <br /><br />
        <div class="row">
          <button
            type="button"
            class="btn btn-warning"
            data-toggle="modal"
            data-target="#loginModal"
          >
            Alterar Cadastro
          </button>
        </div>
        <br />
        <hr />
      </div>
      <!-- Modal -->
      <div
        class="modal fade"
        id="loginModal"
        tabindex="-1"
        role="dialog"
        aria-labelledby="loginModalLabel"
        aria-hidden="true"
      >
        <div class="modal-dialog" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="loginModalLabel">Login App</h5>
              <button
                type="button"
                class="close"
                data-dismiss="modal"
                aria-label="Close"
              >
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div class="modal-body">
              <div id="login-box" class="col">
                <form
                  id="login-form"
                  class="form-modal"
                  method="post"
                  onsubmit="loginUser (this)"
                >
                  <h2 class="text-center text-dark">Cadastrar usuário</h2>
                  <br />
                  <div class="form-group">
                    <label for="login" class="text-dark">Usuário</label><br />
                    <input
                      type="text"
                      class="modal_login"
                      name="txt_login"
                      id="txt_login"
                      class="form-control"
                    />
                  </div>
                  <div class="form-group">
                    <label for="nome" class="text-dark">Nome completo</label
                    ><br />
                    <input
                      type="text"
                      class="modal_login"
                      name="txt_nome"
                      id="txt_nome"
                      class="form-control"
                    />
                  </div>
                  <div class="form-group">
                    <label for="email" class="text-dark">email</label><br />
                    <input
                      type="text"
                      class="modal_login"
                      name="txt_email"
                      id="txt_email"
                      class="form-control"
                    />
                  </div>
                  <div class="form-group">
                    <label for="senha" class="text-dark">Senha</label><br />
                    <input
                      type="password"
                      class="modal_login"
                      name="txt_senha"
                      id="txt_senha"
                      class="form-control"
                    />
                  </div>
                  <div class="form-group">
                    <label for="senha2" class="text-dark"
                      >Confirmação de Senha</label
                    ><br />
                    <input
                      type="password"
                      class="modal_login"
                      name="txt_senha2"
                      id="txt_senha2"
                      class="form-control"
                    />
                  </div>
                </form>
              </div>
            </div>
            <div class="modal-footer">
              <button
                type="button"
                class="btn btn-secondary"
                data-dismiss="modal"
              >
                Cancelar
              </button>
              <button type="button" id="btn_salvar" class="btn btn-info">
                Salvar
              </button>
            </div>
          </div>
        </div>
      </div>

      <script src="JS/login.js"></script>
      <script>
        // Declara uma função para processar o formulário de login
        function processaFormLogin(event) {
          // Cancela a submissão do formulário para tratar sem fazer refresh da tela
          event.preventDefault();

          // Obtem os dados de login e senha a partir do formulário de login
          var username = document.getElementById("username").value;
          var password = document.getElementById("password").value;

          // Valida login e se estiver ok, redireciona para tela inicial da aplicação
          resultadoLogin = loginUser(username, password);
          if (resultadoLogin) {
            window.location.href = "index.html";
          } else {
            // Se login falhou, avisa ao usuário
            alert("Usuário ou senha incorretos");
          }
        }

        function salvaLogin(event) {
          // Cancela a submissão do formulário para tratar sem fazer refresh da tela
          event.preventDefault();

          // Obtem os dados do formulário
          let login = document.getElementById("txt_login").value;
          let nome = document.getElementById("txt_nome").value;
          let email = document.getElementById("txt_email").value;
          let senha = document.getElementById("txt_senha").value;
          let senha2 = document.getElementById("txt_senha2").value;
          if (senha != senha2) {
            alert("As senhas informadas não conferem.");
            return;
          }

          // Adiciona o usuário no banco de dados
          addUser(nome, login, senha, email);
          alert(
            "Usuário salvo com sucesso. Proceda com o login para continuar"
          );
          window.location.href = "login.html";

          // Oculta a div modal do login
          //document.getElementById ('loginModal').style.display = 'none';
          $("#loginModal").modal("hide");
        }

        // Associa a funçao processaFormLogin  formulário adicionado um manipulador do evento submit
        document
          .getElementById("login-form")
          .addEventListener("submit", processaFormLogin);

        // Associar salvamento ao botao
        document
          .getElementById("btn_salvar")
          .addEventListener("click", salvaLogin);
      </script>

      <script
        src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
        integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
        crossorigin="anonymous"
      ></script>
      <script
        src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
        integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
        crossorigin="anonymous"
      ></script>
      <script
        src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
        integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
        crossorigin="anonymous"
      ></script>
    </div>
    <!--Rodapé-->
    <footer class="page-footer bg-danger">
      <div class="container">
        <hr class="bg-hex" style="margin: 0 15%" />
        <div class="row d-flex text-center justify-content-center mb-md-0 mb-4">
          <div class="col-md-8 col-12 mt-5">
            <p style="line-height: 1.7rem; color: white">
              Multi Express <br />Contato: mex@gmail.com.br
            </p>
          </div>
        </div>
        <hr class="clearfix d-md-none bg-white" style="margin: 10% 15% 5%" />
        <!-- Copyright -->
        <div class="footer-copyright text-center py-3" style="color: white">
          © 2019 Copyright: Bootstrap<br />
        </div>
        <br />
      </div>
    </footer>
  </body>
</html>
